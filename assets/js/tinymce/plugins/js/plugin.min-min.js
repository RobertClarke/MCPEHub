tinymce.PluginManager.add("smileys",function(t,e){function n(){var t;return t='<table role="presentation" class="mce-grid">',tinymce.each(u,function(e){t+="<tr>",tinymce.each(e,function(e){t+='<td><a href="#" data-mce-url="'+e.url+'" tabindex="-1" title="'+e.title+'"><img src="/assets/img/smilies/'+e.url+'" style="width: 16px; height: 16px"></a></td>'}),t+="</tr>"}),t+="</table>"}function i(t){var e=tinymce.each,n=[];return e(t,function(t){n=n.concat(t)}),n.length>0?n:t}function r(t,e,n,i,r){function o(t,e){e=e||0;var n=t.index;if(e>0){var i=t[e];n+=t[0].indexOf(i),t[0]=i}return[n,n+t[0].length,[t[0]]]}function l(t){var e;if(3===t.nodeType)return t.data;if(p[t.nodeName]&&!m[t.nodeName])return"";if(e="",(m[t.nodeName]||f[t.nodeName])&&(e+="\n"),t=t.firstChild)do e+=l(t);while(t=t.nextSibling);return e}function s(t,e,n){var i,r,o,l,s=[],u=0,a=t,c=e.shift(),d=0;t:for(;;){if((m[a.nodeName]||f[a.nodeName])&&u++,3===a.nodeType&&(!r&&a.length+u>=c[1]?(r=a,l=c[1]-u):i&&s.push(a),!i&&a.length+u>c[0]&&(i=a,o=c[0]-u),u+=a.length),i&&r){if(a=n({startNode:i,startNodeIndex:o,endNode:r,endNodeIndex:l,innerNodes:s,match:c[2],matchIndex:d}),u-=r.length-l,i=null,r=null,s=[],c=e.shift(),d++,!c)break}else{if((!p[a.nodeName]||m[a.nodeName])&&a.firstChild){a=a.firstChild;continue}if(a.nextSibling){a=a.nextSibling;continue}}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===t)break t;a=a.parentNode}}}function u(t){var e;if("function"!=typeof t){var n=t.nodeType?t:h.createElement(t);e=function(){var t=n.cloneNode(!1);return t}}else e=t;return function i(t){var n,i,r,o=t.startNode,l=t.endNode;if(o===l){var s=o;r=s.parentNode,t.startNodeIndex>0&&(n=h.createTextNode(s.data.substring(0,t.startNodeIndex)),r.insertBefore(n,s));var u=e();return r.insertBefore(u,s),t.endNodeIndex<s.length&&(i=h.createTextNode(s.data.substring(t.endNodeIndex)),r.insertBefore(i,s)),s.parentNode.removeChild(s),u}}}var a,c=[],d,g=0,h,m,p,f;if(h=e.ownerDocument,m=r.getBlockElements(),p=r.getWhiteSpaceElements(),f=r.getShortEndedElements(),d=l(e)){for(;a=t.exec(d);)c.push(o(a,i));return c.length&&(g=c.length,s(e,c,u(n))),g}}function o(e){var n=t.selection.getNode(),i,o=e.shortcut.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return i=t.dom.create("img",{src:e.url,title:e.title}),r(new RegExp(o,"gi"),n,i,!1,t.schema)}var l=[[{shortcut:":)",url:"Smile.png",title:""},{shortcut:":(",url:"Frown.png",title:""},{shortcut:":|",url:"Slant.png",title:""},{shortcut:";)",url:"Wink.png",title:""},{shortcut:":D",url:"Grin.png",title:""},{shortcut:":S",url:"Confused.png",title:""},{shortcut:":P",url:"Crazy.png",title:""}],[{shortcut:":o",url:"Gasp.png",title:""},{shortcut:"8)",url:"Cool.png",title:""},{shortcut:">=(",url:"Angry.png",title:""},{shortcut:">_>",url:"Not-Amused.png",title:""},{shortcut:"(y)",url:"Thumbs-Up.png",title:""},{shortcut:"(n)",url:"Thumbs-Down.png",title:""},{shortcut:"<3",url:"Heart.png",title:""}],[{shortcut:"[diamond]",url:"diamond.png",title:""},{shortcut:"[diamond pick]",url:"diamond_pick.png",title:""},{shortcut:"[coal]",url:"coal.png",title:""},{shortcut:"[tnt]",url:"tnt.png",title:""},{shortcut:"[cake]",url:"cake.png",title:""},{shortcut:"[cookie]",url:"cookie.png",title:""},{shortcut:"[apple]",url:"apple.png",title:""}]],s=t.settings.smileys||l,u=t.settings.extended_smileys?s.concat(t.settings.extended_smileys):s;t.on("keyup",function(e){if(!t.settings.auto_convert_smileys){var n=tinymce.each,r=t.selection,l=r.getNode();console.log(u),l&&n(i(u),function(t){o(t)})}}),t.addButton("smileys",{type:"panelbutton",icon:"emoticons",panel:{autohide:!0,html:n,onclick:function(e){var n=t.dom.getParent(e.target,"a");n&&(t.insertContent('<img src="/assets/img/smilies/'+n.getAttribute("data-mce-url")+'" />'),this.hide())}},tooltip:"Smileys"})});